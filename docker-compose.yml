version: '3.8'

services:
  builder:
    build: .
    volumes:
      - .:/app
    command: >
      bash -c "rm -rf release/*.exe release/*.AppImage release/*.snap && npm install && npm run electron:build:all"

  android-builder:
    build:
      context: .
      dockerfile: Dockerfile.android
    volumes:
      - .:/app
    command: >
      bash -c "npm install && npm run build && npx cap sync && cd android && ./gradlew assembleDebug && cp app/build/outputs/apk/debug/app-debug.apk /app/release/palladium-chat.apk"
